---
// imports
import Layout from "../../layouts/Layout.astro";
import MeowIsland from "../../components/MeowIsland.tsx"; // <- create this next!
import Cats from "../../components/Cats.tsx"; // <- optional, also create
import { getItemFromDB, getReplies } from "../../lib/data"; // <- youâ€™ll make this too

const { params } = Astro;
const username = params.username;
const itemSlug = params.item;

// TODO: replace these with real calls to D1 or KV
const item = await getItemFromDB(username, itemSlug);
const replies = await getReplies(username, itemSlug);
---

<Layout>
    <article>
        <h1>@{username} posted: {item.title}</h1>
        <div class="item-content" set:html={item.content} />

        <section>
            <h2>Replies</h2>
            <ul>
                {
                    replies.map((reply) => (
                        <li>
                            <strong>{reply.author}</strong>: {reply.content}
                        </li>
                    ))
                }
            </ul>
        </section>
    </article>

    <!-- Meow editor -->
    <div id="meow">
        <MeowIsland client:load />
    </div>

    <!-- 3D Cats World (React Three Fiber) -->
    <div id="cats">
        <Cats client:only="react" roomId={itemSlug} />
    </div>
</Layout>
